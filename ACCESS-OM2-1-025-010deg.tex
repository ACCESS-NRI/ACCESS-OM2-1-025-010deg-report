%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% This will not run without gitinfo2 git hooks set up
% see https://ctan.org/pkg/gitinfo2
% This should work automatically if this file is obtained via
% git clone -- TODO: check and finish!
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[11pt]{article}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{a4paper}                   % ... or a4paper or a5paper or ... 
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{amssymb}
%\usepackage{epstopdf}
%\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

\usepackage{ifthen}
\newboolean{gitinfo}\setboolean{gitinfo}{false} % whether use gitinfo2 to provide git detail (doesn't work in overleaf)

\usepackage{color}
\definecolor{link}{rgb}{0,0,1}
\usepackage[a4paper,colorlinks,
linkcolor={link},citecolor={link},pagecolor={link},urlcolor={link},
 breaklinks, bookmarks, bookmarksopen, bookmarksnumbered
]{hyperref}
\usepackage{url}\urlstyle{sf} % rm, sf, tt or same
%% Define a new style for the urls that will use a smaller font.
\makeatletter
\def\url@smallurlstyle{%
  \@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\footnotesize\sffamily}}}
\makeatother
%% Now actually use the newly defined style.
\urlstyle{smallurl}
\usepackage{PTSansNarrow} % narrow sans serif font for urls
\usepackage[scaled=.9]{inconsolata}
\usepackage{mathpazo}
\usepackage{datetime2}
\ifthenelse{\boolean{gitinfo}}{\usepackage[grumpy]{gitinfo2}}{}
\DTMsetdatestyle{iso}
\usepackage{natbib}
%\usepackage{longtable}
\usepackage{ltablex}\keepXColumns
\usepackage{sistyle}
\usepackage{array}
%\usepackage[strings]{underscore} % allows hyphenation at underscores

\newcommand{\note}[1]{#1} % show all notes
%\newcommand{\note}[1]{\quad}     % hide all notes
\newcommand{\TODO}[1]{\note{\textcolor{blue}{\textsf{\textbf{TODO: #1}}}}}
\newcommand{\FIXME}[1]{\note{\textcolor{red}{\textsf{\textbf{FIXME: #1}}}}}

\title{ACCESS-OM2: The Australian Community Climate and Earth-System Simulator Ocean Model 2}
\author{Andrew Kiss, Andy Hogg, Paul Spence, Fanghua Wu, Kial Stewart,\\ Stephen Griffies, Nicholas Hannah, Russell Fiedler, Aidan Heerdegen,\\
Matthew England, Adele Morrison, Simon Marsland\\
\TODO{add anyone who's missing (order is arbitrary at this stage)}}
\date{\textsf{The latest version of this document is available from \url{https://github.com/aekiss/ACCESS-OM2-1-025-010deg-report}\\
and \url{https://www.overleaf.com/11449164wmwcrxynvgpx}\\[1ex]
\hfill{\footnotesize This version: typeset \today\ \DTMcurrenttime\ \DTMcurrentzone \\ 
\ifthenelse{\boolean{gitinfo}}{%
\hfill Last commit%
\ifthenelse{\equal{\gitDirty}{}}{:}{ (\emph{didn't commit all tracked changes}):}
git hash: \gitAbbrevHash\ 
\gitCommitterIsoDate, \\\hfill committed to branch ``\gitBranch '' by \gitCommitterName\\
\ifthenelse{\equal{\gitRoff}{}}{}{\hfill \gitRoff\ commit(s) since release \gitRel \\} 
%\gitDirty\ 
%committed by \gitCommitterName , \gitCommitterIsoDate\ \\
\hfill\textbf{NB: git hash does not reflect any uncommitted changes to this document.}
}
{\textbf{set `gitinfo' boolean to `true' in preamble to show git version information (doesn't work in Overleaf)}
}
%\TODO{automatically warn if there are uncommitted changes - eg by \url{https://www.ctan.org/pkg/latexgit}}
%\FIXME{is there any way include the pdf in the git repo and also have it show an up-to-date git hash?? --- see p12 of gitinfo2 documentation}
}}\\
\raggedright{\vspace{10ex}
CONTRIBUTORS PLEASE NOTE:\\
\begin{itemize}
\item to make git diffs easier, please write each sentence on a separate line
\item add ``to do'' items using $\backslash$TODO\{\ldots\}
\item note errors and problems using $\backslash$FIXME\{\ldots\}
\item use a bare number (no leading v) if you do git tags (for compatibility with the gitinfo2 package used here)
\end{itemize}
}}

\begin{document}
\maketitle

\tableofcontents
\listoffigures


\section{Introduction}
This technical report documents the ACCESS-OM2 ocean-sea ice model at nominal horizontal resolutions of $1^\circ$, $0.25^\circ$ and $0.1^\circ$.

\section{Model Configuration}

\subsection{Overview}
MOM, CICE, OASIS, JRA55

cf.\ CORE \citep{GriffiesBiastochBoningBryanDanabasogluChassignetEnglandGerdesHaak2009a}, CORE-II \citep{DanabasogluYeagerBaileyBehrensBentsenBiBiastochBoningBozec2014a}

\subsection{MOM version and settings}

\subsection{Grid}
Discuss KDS vertical grid \citet{StewartHoggGriffiesHeerdegenWardSpenceEngland2017a}


\subsection{Bathymetry}
based on Gebco2014 30sec gridded data % located at /g/data3/hh5/tmp/cosima/bathymetry/gebco.nc
\FIXME{which version?} \url{http://www.gebco.net/data_and_products/gridded_bathymetry_data/gebco_30_second_grid/}

\subsection{CICE}

\subsection{OASIS}

\TODO{Nic's work on ESMF regridding}


\subsection{Forcing}

JRA55 version

discuss choice of year for RYF

Regridding method

Runoff - incl distributed iceberg melt?

Restoring (e.g.\ salt)

World Ocean Atlas 2013 \FIXME{version 2?} \url{https://www.nodc.noaa.gov/OC5/woa13/}

\subsection{Initial conditions and spinup}

\section{Model computational performance}

\section{Model evaluation}
 - do this via a cookbook that emits all needed pngs/pdfs 

\subsection{Global conservation and drift}

\subsubsection{Heat}

\subsubsection{Salt}

\subsubsection{Fresh water}

\subsubsection{Sea ice}


\subsection{Transports through key straits and boundary currents}

\subsection{Overturning}

\subsection{Water mass properties}

\subsection{EKE}

\subsection{Time-dependence, eg of WBCs}

\subsection{Sea ice - area, thickness, formation rate}

\appendix
\section{Auto-generated namelists}


% \newcommand{\nmldiffer}[1]{#1} % no special display of differing variables
%\newcommand{\nmldiffer}[1]{\textbf{#1}} % bold display of differing variables
\definecolor{hilite}{cmyk}{0, 0, 0.9, 0}\newcommand{\nmldiffer}[1]{\colorbox{hilite}{#1}}\setlength{\fboxsep}{0pt} % colour highlight of differing variables (requires color package)
\newcommand{\nmllink}[2]{#1} % don't link variables
% \newcommand{\nmllink}[2]{\href{https://github.com/mom-ocean/MOM5/search?q=#2}{#1}} % link variables to documentation (requires hyperref package)
%\newcommand{\nml}[1]{{\small\textsf{\input{local/#1}}}}
\newcommand{\nml}[1]{{\small\textsf{\input{raijin/#1}}}}
\newlength{\nmllen}\setlength{\nmllen}{13ex}

These are auto-generated by make\_nml\_tables.py.
Variables are \textcolor{link}{weblinks} to source code searches. Variables that differ between the models are \nmldiffer{\textcolor{link}{highlighted}}.

\subsection{MOM namelist `input.nml'}
\renewcommand{\nmllink}[2]{\href{https://github.com/mom-ocean/MOM5/search?q=#2}{#1}} % link to documentation (requires hyperref package)
\nml{input_nml.tex}

\subsection{CICE namelists}
\renewcommand{\nmllink}[2]{\href{https://github.com/OceansAus/cice5/search?q=#2}{#1}} % link to documentation (requires hyperref package)
\TODO{check whether all ice nmls are relevant}
\subsubsection{input\_ice.nml}
\nml{input_ice_nml.tex}
\subsubsection{input\_ice\_gfdl.nml}
\nml{input_ice_gfdl_nml.tex}
\subsubsection{input\_ice\_monin.nml}
\nml{input_ice_monin_nml.tex}
\subsubsection{cice\_in.nml}
\nml{cice_in_nml.tex}

\subsection{MATM namelist `input\_atm.nml'}
\renewcommand{\nmllink}[2]{\href{https://github.com/OceansAus/matm/search?q=#2}{#1}} % link to documentation (requires hyperref package)
\nml{input_atm_nml.tex}

\bibliographystyle{ametsoc2014}
\bibliography{ACCESS-OM2-1-025-010deg}

\end{document}  