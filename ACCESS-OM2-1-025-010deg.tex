\documentclass[11pt]{article}
\usepackage{ifthen}
\newboolean{gitinfo}\setboolean{gitinfo}{true} % whether use gitinfo2 to provide git detail (doesn't work in Overleaf; you may also need to run RUNME.sh)

\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{a4paper}                   % ... or a4paper or a5paper or ... 
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{amssymb}
%\usepackage{epstopdf}
%\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}


\usepackage[table]{xcolor}    % loads also ÈcolortblÇ
\definecolor{lightblue}{rgb}{0.93,0.95,1.0}
%\rowcolors{2}{blue!4}{white}
\rowcolors{1}{lightblue}{white}
\definecolor{link}{rgb}{0,0,1}
\usepackage[colorlinks,
linkcolor={link},citecolor={link},urlcolor={link},
 breaklinks, bookmarks, bookmarksopen, bookmarksnumbered
]{hyperref}
\usepackage{url}\urlstyle{sf} % rm, sf, tt or same
%% Define a new style for the urls that will use a smaller font.
\makeatletter
\def\url@smallurlstyle{%
  \@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\footnotesize\sffamily}}}
\makeatother
%% Now actually use the newly defined style.
\urlstyle{smallurl}
\usepackage{PTSansNarrow} % narrow sans serif font for urls
\usepackage[scaled=.9]{inconsolata} % for texttt
\usepackage{mathpazo}
\usepackage{datetime2}\DTMsetdatestyle{iso}
\ifthenelse{\boolean{gitinfo}}{\usepackage[grumpy]{gitinfo2}}{}
\usepackage{natbib}
\usepackage{ltablex}\keepXColumns
\usepackage{sistyle}
\usepackage{array}
\usepackage[strings]{underscore} % allows hyphenation at underscores
\usepackage[nooneline,small,hypcap=true]{caption} % correct hypcap needs v 3.1 or higher
\renewcommand{\captionlabelfont}{\bfseries}
\setlength{\captionmargin}{0.5cm} \setlength{\abovecaptionskip}{3pt}

\newcommand{\note}[1]{#1} % show all notes
%\newcommand{\note}[1]{\quad} % hide all notes
\newcommand{\TODO}[1]{\note{\textcolor{blue}{\textsf{\textbf{TODO: #1}}}}}
\newcommand{\FIXME}[1]{\note{\textcolor{red}{\textsf{\textbf{FIXME: #1}}}}}

\title{ACCESS-OM2: The Australian Community Climate and Earth-System Simulator Ocean Model 2}
\author{
Andrew Kiss, Andy Hogg, Kial Stewart, Adele Morrison, Aidan Heerdegen (ANU);\\
Nicholas Hannah (Double Precision); 
Paul Spence, Matthew England (UNSW); \\
Russell Fiedler, Simon Marsland, Peter Oke (CSIRO); \\
Maxim Nikurashin (UTas); 
Petra Heil (AAD \& ACE CRC, UTas); \\
Gary Brassington (BoM);
Fanghua Wu (Beijing Climate Center); \\
Stephen Griffies (GFDL); 
James Munroe (Memorial U.\ Newfoundland)\\
\TODO{add anyone who's missing (order is arbitrary at this stage)}}
\date{\textsf{The latest version of this document is available from\\
GitHub: \url{https://github.com/aekiss/ACCESS-OM2-1-025-010deg-report}\\
and Overleaf: \url{https://www.overleaf.com/11449164wmwcrxynvgpx}
(to use Overleaf with git, see \url{https://www.overleaf.com/blog/195-new-collaborate-online-and-offline-with-overleaf-and-git-beta}).\\[1ex]
\hfill{\footnotesize This version: typeset \today\ \DTMcurrenttime\ \DTMcurrentzone \\ 
\ifthenelse{\boolean{gitinfo}}{%
\hfill Last commit%
\ifthenelse{\equal{\gitDirty}{}}{:}{ (\emph{didn't commit all tracked changes}):}
git hash: \gitAbbrevHash\ 
\gitCommitterIsoDate, \\\hfill committed to branch ``\gitBranch '' by \gitCommitterName\\
\ifthenelse{\equal{\gitRoff}{}}{}{\hfill \gitRoff\ commit(s) since release \gitRel \\} 
%\gitDirty\ 
%committed by \gitCommitterName , \gitCommitterIsoDate\ \\
\hfill\textbf{NB: git hash does not reflect any uncommitted changes to this document.}\\
\hfill\textbf{\textcolor{red}{Set `gitinfo' boolean to `false' in preamble before pushing to  Overleaf.}}
}
{\hfill Set `gitinfo' boolean to `true' in preamble to show git version information (doesn't work in Overleaf; you may also need to run RUNME.sh).
}
%\TODO{automatically warn if there are uncommitted changes - eg by \url{https://www.ctan.org/pkg/latexgit}}
%\FIXME{is there any way include the pdf in the git repo and also have it show an up-to-date git hash?? --- see p12 of gitinfo2 documentation}
}}\\
\raggedright{\vspace{10ex}
CONTRIBUTORS PLEASE NOTE:\\
\begin{itemize}
\item to make git diffs easier, please write each sentence on a separate line
\item add ``to do'' items using $\backslash$TODO\{\ldots\}
\item note errors and problems using $\backslash$FIXME\{\ldots\}
\item use a bare number (no leading v) if you do git tags (for compatibility with the gitinfo2 package used here)
\end{itemize}
}}

\begin{document}
\maketitle

\tableofcontents
\listoffigures

\TODO{copy things in from poster}

\section{Introduction}
This technical report documents the ACCESS-OM2 ocean-sea ice model at nominal horizontal resolutions of $1^\circ$, $0.25^\circ$ and $0.1^\circ$.

\section{Model Configuration}

\subsection{Overview}
MOM, CICE, OASIS, JRA55

cf.\ CORE \citep{GriffiesBiastochBoningBryanDanabasogluChassignetEnglandGerdesHaak2009a}, CORE-II \citep{DanabasogluYeagerBaileyBehrensBentsenBiBiastochBoningBozec2014a}

cf. ACCESS \citet{BiDixMarslandOFarrellRashidUotilaHirstKowalczykGolebiewski2013a,BiMarslandUotilaOFarrellFiedlerSullivanGriffiesZhouHirst2013a,DixVohralikBiRashidMarslandOFarrellUotilaHirstKowalczyk2013a}

cf. CM2-1deg CM2.5 CM2.6 (they were MOM v5) and discuss resolving eddies: \citet{GriffiesWintonAndersonBensonDelworthDufourDunneGoddardMorrison2015a}
\citet{DelworthRosatiAndersonAdcroftBalajiBensonDixonGriffiesLee2012a}
\citet{DunneJohnAdcroftGriffiesHallbergShevliakovaStoufferCookeDunne2012a}

\subsection{MOM version and settings}
\TODO{cannibalise NCMAS application}

\subsection{Grid}

\subsubsection{Vertical grid}

\begin{table}
\newcolumntype{R}{>{\raggedleft\arraybackslash}p{13ex}}
\begin{tabularx}{\linewidth}{XRRRR}
\hline
Model	 & 	$n$	&	$\Delta z_\text{min}$ (m)	& 	$\Delta z_\text{max}$ (m)	& 	$H_\text{max}$ (m)	\\
\hline\endfirsthead
\hline
Model	 & 	$n$	&	$\Delta z_\text{min}$ (m)	& 	$\Delta z_\text{max}$ (m)	& 	$H_\text{max}$ (m)	\\
\hline\endhead
ACCESS-OM2		&	50	&	10.0	&	334.7		&	6000.0\\	
ACCESS-OM2-025	&	50	&	10.1	&	209.9		&	5500.0\\
ACCESS-OM2-01	&	75	&	1.1	&	198.4	&	5808.7\\
\hline
\end{tabularx}
\caption{Vertical grid parameters: $n$ levels, with spacing of $\Delta z_\text{min}$ and $\Delta z_\text{max}$ at the surface and maximum depth $H_\text{max}$, respectively.\TODO{these are discretised values from ocean_vgrid.nc - check that I'm correctly using the notation matches in \citet{StewartHoggGriffiesHeerdegenWardSpenceEngland2017a}}}\label{T:vgrid}
\end{table}
See table~\ref{T:vgrid}.

Discuss KDS vertical grid \citet{StewartHoggGriffiesHeerdegenWardSpenceEngland2017a}
\TODO{present as a table as in \citet{StewartHoggGriffiesHeerdegenWardSpenceEngland2017a}, using the same notation}

% NB: z levels are the odd entries in ocean_vgrid.nc (counting from zero)
% ocean_grids.F90 line 297: size of dimension zeta in ocean_vgrid.nc is 2*nk+1
% ocean_grids.F90 line 446,661: T points (zt) at zeta(2k-1), w points (zw) at zeta(2k), k=1,nk  [NB in line 661 it appears read_data indexes from 2??]

% [ ( <paste ncdump> ) (,) () replace pop ] 0:2: pick dup diff

ACCESS-OM2: GFDL50 \FIXME{wrong? doesn't match GFDL50 in table 1 of \citet{StewartHoggGriffiesHeerdegenWardSpenceEngland2017a}} 50 levels, 10.0m spacing in top 200m then increasing smoothly to 334.7m by the bottom at 6000m. % ncdump /short/v45/aek156/access-om2/input/mom_1deg/ocean_vgrid.nc

ACCESS-OM2-025: KDS50 \FIXME{wrong? doesn't match KDS50 in table 1 of \citet{StewartHoggGriffiesHeerdegenWardSpenceEngland2017a}} 50 levels, 10.1m spacing at surface, increasing smoothly to 209.9m by the bottom at 5500m. % ncdump /short/v45/aek156/access-om2/input/mom_025deg/ocean_vgrid.nc

ACCESS-OM2-01: KDS75 \TODO{check: maximum spacing and depth slightly different from KDS75} 75 levels, 1.1m spacing at surface, increasing smoothly to 198.4m by the bottom at 5808.7m. % ncdump /short/v45/aek156/access-om2/input/mom_01deg/ocean_vgrid.nc

\subsubsection{Horizontal grid}
% ncdump -h /short/v45/aek156/access-om2/input/mom_1deg/ocean_hgrid.nc
% ncdump -h /short/v45/aek156/access-om2/input/mom_025deg/ocean_hgrid.nc
% ncdump -h /short/v45/aek156/access-om2/input/mom_01deg/ocean_hgrid.nc

1/10 deg: 3600 x 2700 x 75 tripolar ocean grid

MOM5.1 with a tripolar grid in the north and Mercator projection down to 65$^\circ$S, with 50-75 vertical levels

southmost latitude of tripolar region? tripole locations?

grid refinement at equator? 1deg only?


%from NCMAS application:
%Model Description	Ocean Model Resolution	Processors	Physical Memory	kSU/yr	Walltime
%ACCESS-OM2	"1$^\circ$, 50 levels"	252	8 Gb/node	0.16	48 years/day																				
%ACCESS-OM2-025	"0.25$^\circ$, 50 levels"	1960	7 Gb/node	3.3	18 years/day																			
%ACCESS-OM2-01	"0.1$^\circ$, 75 levels"	5600	13 Gb/node	55	3 years/day																				

\subsection{Bathymetry}
based on Gebco2014 30sec gridded data % located at /g/data3/hh5/tmp/cosima/bathymetry/gebco.nc
\FIXME{which version?} \url{http://www.gebco.net/data_and_products/gridded_bathymetry_data/gebco_30_second_grid/}

\subsection{CICE}

\subsection{OASIS}

\TODO{Nic's work on ESMF regridding}


\subsection{Forcing}

JRA55 version 1.3 \TODO{check}

discuss choice of year for RYF

Regridding method

Runoff - incl distributed iceberg melt?

Restoring (e.g.\ salt)

World Ocean Atlas 2013 \FIXME{version 2?} \url{https://www.nodc.noaa.gov/OC5/woa13/}

\subsection{Initial conditions and spinup}

\section{Model computational performance}
1/10 deg: 5600 processors

\section{Model evaluation}
 - do this via a cookbook that emits all needed pngs/pdfs 

\subsection{Global conservation and drift}

\subsubsection{Heat}

\subsubsection{Salt}

\subsubsection{Fresh water}

\subsubsection{Sea ice}
\citet{UotilaOFarrellMarslandBi2013a}

\subsection{Transports through key straits and boundary currents}

\subsection{Overturning}

\subsection{Water mass properties}

\subsection{EKE}

\subsection{Time-dependence, eg of WBCs}

\subsection{Sea ice - area, thickness, formation rate}

\appendix
\section{Auto-generated namelists}


% \newcommand{\nmldiffer}[1]{#1} % no special display of differing variables
%\newcommand{\nmldiffer}[1]{\textbf{#1}} % bold display of differing variables
\definecolor{hilite}{cmyk}{0, 0, 0.9, 0}\newcommand{\nmldiffer}[1]{\colorbox{hilite}{#1}}\setlength{\fboxsep}{0pt} % colour highlight of differing variables (requires color package)
\newcommand{\nmllink}[2]{#1} % don't link variables
% \newcommand{\nmllink}[2]{\href{https://github.com/mom-ocean/MOM5/search?q=#2}{#1}} % link variables to documentation (requires hyperref package)
%\newcommand{\nml}[1]{{\small\textsf{\input{local/#1}}}} % use nml tables generated from local files
\newcommand{\nml}[1]{{\small\textsf{\input{raijin/#1}}}} % use nml tables generated on raijin
\newlength{\nmllen}\setlength{\nmllen}{13ex}

These are auto-generated by make\_nml\_tables.py.
Variables are \textcolor{link}{weblinks} to source code searches. Variables that differ between the models are \nmldiffer{\textcolor{link}{highlighted}}.
\rowcolors{1}{lightblue}{white}

\subsection{MOM namelist `input.nml'}
\renewcommand{\nmllink}[2]{\href{https://github.com/mom-ocean/MOM5/search?q=#2}{#1}} % link to documentation (requires hyperref package)
\nml{input_nml.tex}

\subsection{CICE namelists}
\renewcommand{\nmllink}[2]{\href{https://github.com/OceansAus/cice5/search?q=#2}{#1}} % link to documentation (requires hyperref package)
\TODO{check whether all ice nmls are relevant}
\subsubsection{input\_ice.nml}
\nml{input_ice_nml.tex}
\subsubsection{input\_ice\_gfdl.nml}
\nml{input_ice_gfdl_nml.tex}
\subsubsection{input\_ice\_monin.nml}
\nml{input_ice_monin_nml.tex}
\subsubsection{cice\_in.nml}
\nml{cice_in_nml.tex}

\subsection{MATM namelist `input\_atm.nml'}
\renewcommand{\nmllink}[2]{\href{https://github.com/OceansAus/matm/search?q=#2}{#1}} % link to documentation (requires hyperref package)
\nml{input_atm_nml.tex}

\bibliographystyle{ametsoc2014}
\bibliography{ACCESS-OM2-1-025-010deg}

\end{document}  